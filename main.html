<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/konva@4.0.3/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>Konva Simple Window drawing</title>
    <style>
      body {
        PADDING: 0;
        margin: 0;
        overflow: hidden;
      }

      #container {
        /* border: 1px solid grey; */
        /* background-color: lightgrey; */
        background-color: #fff;
      }

      #controls {
        position: absolute;
        top: 4px;
        left: 4px;
      }
    </style>
  </head>

  <body>
    <div id="container"></div>

    <div id="controls">
      <div style="float: left; PADDING: 10px">
        Length:
        <input type="number" id="widthInput" />
      </div>
      <div style="float: left; PADDING: 10px">
        Width:
        <input type="number" id="heightInput" />
      </div>
    </div>
    <script>

      // Constants
      const SCALE_FACTOR = 0.65;
      const PADDING = 70; // mm

      // planter dimensions
      var PLANTER_WIDTH = 300;
      var PLANTER_LENGTH = 800;


      var width = window.innerWidth;
      var height = window.innerHeight;

      var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
      });

      var layer = new Konva.Layer();
      stage.add(layer);

      var widthInput = document.getElementById('widthInput');
      var heightInput = document.getElementById('heightInput');


      // Draws the four corners of the rectangular balcony
      function createCorners(frameWidth, frameHeight) {

        var PADDING = 70;   // width of railing
        var group = new Konva.Group();

        var topLeft = new Konva.Line({
          points: [
            0,       0,
            PADDING, 0,
            PADDING, PADDING,
            0,       0,
            0,       PADDING,
            PADDING, PADDING,
          ],
          fill: 'white'
        });

        var topRight = new Konva.Line({
          points: [
            frameWidth, 0,
            frameWidth-PADDING, 0,
            frameWidth-PADDING, PADDING,
            frameWidth, 0,
            frameWidth, PADDING,
            frameWidth-PADDING, PADDING,
          ],
          fill: 'white'
        });

        var bottomRight = new Konva.Line({
          points: [
            frameWidth,         frameHeight,
            frameWidth-PADDING, frameHeight,
            frameWidth-PADDING, frameHeight-PADDING,
            frameWidth,         frameHeight,
            frameWidth,         frameHeight-PADDING,
            frameWidth-PADDING, frameHeight-PADDING,
          ],
          fill: 'white'
        });

        var bottomLeft = new Konva.Line({
          points: [
            0,       frameHeight,
            PADDING, frameHeight,
            PADDING, frameHeight-PADDING,
            0,       frameHeight,
            0,       frameHeight-PADDING,
            PADDING, frameHeight-PADDING,
          ],
          fill: 'white'
        });

        group.add(topLeft, topRight, bottomRight, bottomLeft);

        group
          .find('Line')
          // .closed(true)
          .stroke('black')
          .strokeWidth(1);

        return group;
      }


      /**
       * Create railing
       */
      function createLengthFrame(frameWidth, frameHeight) {

        var PADDING = 70;   // width of railing
        var group = new Konva.Group();

        var topDim = frameWidth - 2*PADDING;
        var numSections = Math.floor(topDim / PLANTER_LENGTH);
        var remainder = topDim % (numSections * PLANTER_LENGTH )
        var sectionLength = remainder / numSections + PLANTER_LENGTH;

        for (let i = 0; i < numSections; i++) {
          console.log('draw section ', i)

          let xOffset = PADDING + (i*sectionLength);
          // draw the top section
          var topSection = new Konva.Line({
            points: [
              xOffset, 0,
              xOffset + sectionLength, 0,
              xOffset + sectionLength, PADDING,
              xOffset, PADDING,
              xOffset, 0,
            ],
            fill: 'white'
          });

          var topSectionFill = new Konva.Rect({
            x: xOffset,
            y: 0,
            width: sectionLength,
            height: PADDING,
            fill: '#EAEAEA'
          });
          topSectionFill.on('mouseover', function() {
            console.log(`top Section ${i} Mouseover`);
          });

          var bottomSection = new Konva.Line({
            points: [
              xOffset, frameHeight-PADDING,
              xOffset + sectionLength, frameHeight-PADDING,
              xOffset + sectionLength, frameHeight,
              xOffset, frameHeight,
              xOffset, frameHeight-PADDING,
            ],
            fill: 'white'
          });

          var bottomSectionFill = new Konva.Rect({
            x: xOffset,
            y: frameHeight-PADDING,
            width: sectionLength,
            height: PADDING,
            fill: '#EAEAEA'
          });
          bottomSectionFill.on('mouseover', function() {
            console.log(`top Section ${i} Mouseover`);
          });

          group.add(topSection, topSectionFill, bottomSection, bottomSectionFill);

        }

        group
          .find('Line')
          .stroke('black')
          .strokeWidth(1);

        return group;
      }


      /**
       * Create railing
       */
      function createWidthFrame(frameWidth, frameHeight) {

        var PADDING = 70;   // width of railing
        var group = new Konva.Group();

        var sideDim = frameHeight - 2*PADDING;
        var numSections = Math.floor(sideDim / PLANTER_LENGTH);
        var remainder = sideDim % (numSections * PLANTER_LENGTH )
        var sectionLength = remainder / numSections + PLANTER_LENGTH;

        for (let i = 0; i < numSections; i++) {

          let yOffset = PADDING + (i*sectionLength);

          // draw the left section and fill it
          var leftSection = new Konva.Line({
            points: [
              0,           yOffset,
              0 + PADDING, yOffset,
              0 + PADDING, yOffset + sectionLength,
              0, yOffset + sectionLength,
              0, 0,
            ],
            fill: 'white'
          });

          var leftSectionFill = new Konva.Rect({
            x: 0,
            y: yOffset,
            width: PADDING,
            height: sectionLength,
            fill: '#EAEAEA'
          });         
          leftSectionFill.on('mouseover', function() {
            console.log(`left Section ${i} Mouseover`);
          });

          // draw the left section and fill it
          var rightSection = new Konva.Line({
            points: [
              frameWidth-PADDING,           yOffset,
              frameWidth-PADDING + PADDING, yOffset,
              frameWidth-PADDING + PADDING, yOffset + sectionLength,
              frameWidth-PADDING, yOffset + sectionLength,
              frameWidth-PADDING, 0,
            ],
            fill: 'white'
          });

          var rightSectionFill = new Konva.Rect({
            x: frameWidth-PADDING,
            y: yOffset,
            width: PADDING,
            height: sectionLength,
            fill: '#EAEAEA'
          });
          rightSectionFill.on('mouseover', function() {
            console.log(`right Section ${i} Mouseover`);
          });

          group.add(leftSection, leftSectionFill, rightSection, rightSectionFill);
        }

        group
          .find('Line')
          // .closed(true)
          .stroke('black')
          .strokeWidth(1);

        return group;
      }

      /**
       * Draw all the planters
       *
       */
      function createPlanter() {

        var group = new Konva.Group();

        var rect1 = new Konva.Rect({
          x: 50,
          y: 200,
          width: 200,
          height: 50,
          fill: '#97FA83',
          stroke: 'black',
          strokeWidth: 2
        });
        // add the shape to the layer
        layer.add(rect1);

        group.add(rect1);

        group
          .find('Line')
          // .closed(true)
          // .stroke('black')
          // .strokeWidth(4);

        return group;

      }

      function createInput(metric, pos, size) {
        var wrap = document.createElement('div');
        wrap.style.position = 'absolute';
        wrap.style.backgroundColor = 'rgba(0,0,0,0.1)';
        wrap.style.top = 0;
        wrap.style.left = 0;
        wrap.style.width = '100%';
        wrap.style.height = '100%';

        document.body.appendChild(wrap);

        var input = document.createElement('input');
        input.type = 'number';

        var similarInput = metric === 'width' ? widthInput : heightInput;
        input.value = similarInput.value;

        input.style.position = 'absolute';
        input.style.top = pos.y + 3 + 'px';
        input.style.left = pos.x + 'px';

        input.style.height = size.height + 3 + 'px';
        input.style.width = size.width + 3 + 'px';

        wrap.appendChild(input);

        input.addEventListener('change', function() {
          similarInput.value = input.value;
          updateCanvas();
        });

        input.addEventListener('input', function() {
          similarInput.value = input.value;
          updateCanvas();
        });

        wrap.addEventListener('click', function(e) {
          if (e.target === wrap) {
            document.body.removeChild(wrap);
          }
        });

        input.addEventListener('keyup', function(e) {
          if (e.keyCode === 13) {
            document.body.removeChild(wrap);
          }
        });
      }

      function updateCanvas() {
        layer.children.destroy();

        var frameWidth = parseInt(widthInput.value, 10);
        var frameHeight = parseInt(heightInput.value, 10);

        var wr = stage.width() / frameWidth;
        var hr = stage.height() / frameHeight;

        var ratio = Math.min(wr, hr) * SCALE_FACTOR;

        var frameOnScreenWidth = frameWidth * ratio;
        var frameOnScreenHeight = frameHeight * ratio;

        var group = new Konva.Group({});

        group.x(Math.round(stage.width() / 2 - frameOnScreenWidth / 2) + 0.5);
        group.y(Math.round(stage.height() / 2 - frameOnScreenHeight / 2) + 0.5);

        layer.add(group);
  
        // Corners
        frameGroup = createCorners(frameWidth, frameHeight);
        frameGroup.scale({ x: ratio, y: ratio });
        group.add(frameGroup);

        // Top and bottom railing
        var frameGroup = createLengthFrame(frameWidth, frameHeight);
        frameGroup.scale({ x: ratio, y: ratio });
        group.add(frameGroup);
        
        // Left and right railing
        frameGroup = createWidthFrame(frameWidth, frameHeight);
        frameGroup.scale({ x: ratio, y: ratio });
        group.add(frameGroup);



        // var planterGroup = createPlanter();
        // planterGroup.scale({ x: ratio, y: ratio });
        // group.add(planterGroup);

        // var infoGroup = createInfo(frameOnScreenWidth, frameOnScreenHeight);
        // group.add(infoGroup);

        layer.draw();
      }

      widthInput.addEventListener('change', updateCanvas);
      widthInput.addEventListener('input', updateCanvas);

      heightInput.addEventListener('change', updateCanvas);
      heightInput.addEventListener('input', updateCanvas);

      // set default value
      widthInput.value = 2000;
      heightInput.value = 1000;

      updateCanvas();
    </script>
  </body>
</html>